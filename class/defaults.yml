parameters:
  openshift_upgrade_controller:
    =_metadata: {}
    namespace: appuio-openshift-upgrade-controller
    namespaceMetadata:
      annotations:
        openshift.io/node-selector: "node-role.kubernetes.io/infra="
      labels:
        openshift.io/cluster-monitoring: "true"

    images:
      openshift_upgrade_controller:
        registry: ghcr.io
        image: appuio/openshift-upgrade-controller
        tag: v0.2.0
      kube_rbac_proxy:
        registry: gcr.io
        image: kubebuilder/kube-rbac-proxy
        tag: v0.14.1

    manifests_version: ${openshift_upgrade_controller:images:openshift_upgrade_controller:tag}

    kustomize_input:
      namespace: ${openshift_upgrade_controller:namespace}

    upgrade_configs: {}

    cluster_version:
      openshiftVersion:
        Major: "4"
        Minor: "11"
      spec:
        upstream: https://api.openshift.com/api/upgrades_info/v1/graph

    alerts:
      NodeDrainStuck:
        enabled: true
        rule:
          annotations:
            description: Node {{$labels.node}} is draining for more than 10 minutes.
            message: Node {{$labels.node}} is draining for more than 10 minutes.
            runbook_url: https://hub.syn.tools/openshift-upgrade-controller/runbooks/NodeDrainStuck.html
            summary: Node is draining for more than 10 minutes.
          expr: |
            openshift_upgrade_controller_node_draining == 1
          for: 10m
          labels:
            severity: warning
            Maintenance: "true"
      MaintenanceInProgress:
        enabled: true
        rule:
          annotations:
            description: Cluster is currently upgrading
            message: An OpenShift upgrade is in progress on this cluster
            summary: Cluster is currently upgrading
          expr: |
            max(max_over_time(openshift_upgrade_controller_cluster_upgrading [10m])) > 0
          for: 0m
          labels:
            severity: info
            Maintenance: "true"
